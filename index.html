<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¾®å…‰å„²è“„</title>
    
    <link rel="apple-touch-icon" href="https://via.placeholder.com/180/4DB6AC/FFFFFF?text=365">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <style>
        :root {
            --bg-base: #F7FAF9;       
            --mint-bright: #4DB6AC;   
            --forest-deep: #2D6A64;   
            --white-card: #FFFFFF;
            --text-color: #37474F;    
        }

        body {
            background-color: var(--bg-base);
            font-family: "PingFang TC", "STHeiti", sans-serif;
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* â˜ï¸ å‹•æ…‹é›²æœµ */
        .cloud { position: absolute; background: white; border-radius: 100px; opacity: 0.6; filter: blur(20px); z-index: -1; animation: floatMove linear infinite; }
        @keyframes floatMove { from { transform: translateX(-200px); } to { transform: translateX(calc(100vw + 200px)); } }

        /* çµ±è¨ˆå€ */
        .dashboard {
            width: 100%; max-width: 340px; display: flex; justify-content: space-around;
            background: rgba(255, 255, 255, 0.7); padding: 18px 0; border-radius: 25px;
            backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(77, 182, 172, 0.08);
            position: relative; margin-top: 10px;
        }
        .dash-item .val { display: block; font-size: 1.3rem; font-weight: 600; color: var(--mint-bright); }
        .dash-item .label { font-size: 0.6rem; letter-spacing: 1px; opacity: 0.6; color: var(--forest-deep); }
        .btn-reset { position: absolute; top: 10px; right: 10px; width: 16px; height: 16px; background: rgba(77, 182, 172, 0.1); border-radius: 50%; border: none; color: var(--mint-bright); font-size: 8px; cursor: pointer; }

        h1 { font-weight: 300; font-size: 0.95rem; letter-spacing: 3px; color: var(--mint-bright); margin: 25px 0; text-align: center; }

        /* å…§å®¹å€ */
        .main-content { width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 5; }

        /* æŠ½å¡å€ */
        .card-box { width: 170px; height: 230px; perspective: 1000px; margin-bottom: 20px; }
        .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; }
        .card.is-flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 35px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: var(--white-card); box-shadow: 0 15px 35px rgba(77, 182, 172, 0.1);
        }
        .card-back { background: linear-gradient(135deg, var(--mint-bright), var(--forest-deep)); transform: rotateY(180deg); color: white; }
        .amt { font-size: 2.5rem; font-weight: 200; }

        /* âœ¨ ä¸‹æ‹‰å¼æ­·å²ç´€éŒ„ */
        .history-wrapper { width: 90%; max-width: 300px; margin-top: 10px; }
        .history-btn {
            width: 100%; background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(77, 182, 172, 0.2);
            padding: 10px; border-radius: 15px; color: var(--forest-deep); font-size: 0.75rem;
            letter-spacing: 2px; cursor: pointer; display: flex; justify-content: center; align-items: center;
            transition: all 0.3s;
        }
        .history-btn::after { content: 'â–¾'; margin-left: 8px; transition: transform 0.3s; }
        .history-btn.active::after { transform: rotate(180deg); }
        
        .history-content {
            max-height: 0; overflow-y: auto; transition: max-height 0.5s ease;
            background: rgba(255, 255, 255, 0.4); border-radius: 0 0 15px 15px; margin-top: -5px;
        }
        .history-content.show { max-height: 150px; border: 1px solid rgba(77, 182, 172, 0.1); border-top: none; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        td { padding: 10px; text-align: center; border-bottom: 1px solid rgba(77, 182, 172, 0.05); }
        .td-amt { color: var(--mint-bright); font-weight: 600; }

        /* ğŸŒ± æ¤ç‰©ç”Ÿé•·å€ */
        .plant-area {
            position: fixed; bottom: 0; width: 100%; height: 120px;
            display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 15px; pointer-events: none; z-index: 1;
        }
        .plant { font-size: 1.5rem; transition: font-size 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); filter: drop-shadow(0 4px 8px rgba(77, 182, 172, 0.1)); }
    </style>
</head>
<body>

    <div class="cloud" style="width: 150px; height: 50px; top: 10%; animation-duration: 45s;"></div>

    <div class="dashboard">
        <button class="btn-reset" onclick="clearAll()">âœ•</button>
        <div class="dash-item"><span class="label">ç´¯ç©é‡‘é¡</span><span class="val" id="total-val">$0</span></div>
        <div class="dash-item"><span class="label">å­˜éŒ¢å¤©æ•¸</span><span class="val" id="days-val">0</span></div>
        <div class="dash-item"><span class="label">å®Œæˆé€²åº¦</span><span class="val" id="perc-val">0%</span></div>
    </div>

    <h1 id="hint">æ¯ä¸€å¤©éƒ½æ˜¯ç¿ ç¶ çš„æ–°ç”Ÿ</h1>

    <div class="main-content">
        <div class="card-box">
            <div class="card" id="card" onclick="flip()">
                <div class="card-face card-front">
                    <span style="font-size: 2.2rem;">â˜€ï¸</span>
                    <p style="font-size: 0.65rem; letter-spacing: 2px; margin-top: 12px; color: var(--mint-bright); font-weight: 600;">æ¡é›†é™½å…‰</p>
                </div>
                <div class="card-face card-back">
                    <span style="font-size: 0.65rem; opacity: 0.8;">ä»Šæ—¥ç²å¾—</span>
                    <div class="amt" id="draw-amt">$0</div>
                </div>
            </div>
        </div>

        <div class="history-wrapper">
            <button class="history-btn" id="history-btn" onclick="toggleHistory()">æŸ¥çœ‹å„²è“„æ­·å²ç´€éŒ„</button>
            <div class="history-content" id="history-content">
                <table>
                    <tbody id="history-list">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="plant-area">
        <span class="plant" id="growing-plant">ğŸŒ±</span>
    </div>

    <script>
        let pool = JSON.parse(localStorage.getItem('v18_pool')) || Array.from({length: 365}, (_, i) => i + 1);
        let logs = JSON.parse(localStorage.getItem('v18_logs')) || [];

        function toggleHistory() {
            const btn = document.getElementById('history-btn');
            const content = document.getElementById('history-content');
            btn.classList.toggle('active');
            content.classList.toggle('show');
        }

        function refresh() {
            const sum = logs.reduce((s, i) => s + i.amount, 0);
            document.getElementById('total-val').innerText = `$${sum.toLocaleString()}`;
            document.getElementById('days-val').innerText = logs.length;
            document.getElementById('perc-val').innerText = Math.round((logs.length/365)*100) + '%';

            // æ›´æ–°æ­·å²è¡¨æ ¼ (å€’åºé¡¯ç¤ºï¼Œæœ€æ–°çš„åœ¨ä¸Šé¢)
            const list = document.getElementById('history-list');
            list.innerHTML = logs.slice().reverse().map(log => {
                const d = log.date.split('/');
                return `<tr><td>${d[1]}/${d[2]}</td><td class="td-amt">$${log.amount}</td><td>âœ”ï¸</td></tr>`;
            }).join('');

            // æ›´æ–°æ¤ç‰©å¤§å°
            const plant = document.getElementById('growing-plant');
            const newSize = 1.5 + (5.5 * Math.min(sum / 50000, 1));
            plant.style.fontSize = `${newSize}rem`;
        }

        function flip() {
            const today = new Date().toLocaleDateString();
            if (logs.length > 0 && logs[logs.length-1].date === today) return;
            const card = document.getElementById('card');
            if (card.classList.contains('is-flipped')) return;

            const idx = Math.floor(Math.random() * pool.length);
            const amt = pool.splice(idx, 1)[0];

            document.getElementById('draw-amt').innerText = `$${amt}`;
            card.classList.add('is-flipped');
            document.getElementById('hint').innerText = "èƒ½é‡å·²çŒæº‰è‡³æ£®æ—";

            logs.push({ date: today, amount: amt });
            localStorage.setItem('v18_pool', JSON.stringify(pool));
            localStorage.setItem('v18_logs', JSON.stringify(logs));

            setTimeout(() => {
                refresh();
                setTimeout(() => { card.classList.remove('is-flipped'); }, 2000);
            }, 600);
        }

        function clearAll() { 
            if(confirm("ç¢ºå®šè¦è®“æ£®æ—é‡æ–°é–‹å§‹å—ï¼Ÿ")) { localStorage.clear(); location.reload(); } 
        }

        refresh();
        const today = new Date().toLocaleDateString();
        if (logs.length > 0 && logs[logs.length-1].date === today) {
            document.getElementById('card').classList.add('is-flipped');
            document.getElementById('draw-amt').innerText = `$${logs[logs.length-1].amount}`;
            document.getElementById('hint').innerText = "ä»Šæ—¥æ¡é›†å·²å®Œæˆ";
        }
    </script>
</body>
</html>
